let paso=1;const paginaInicial=1,paginaFinal=3,cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function iniciarApp(){mostrarSeccion(),tabs(),botonesPaginador(),paginaSiguiente(),paginaAnterior(),consultarAPI(),nombreCliente(),seleccionarFecha(),seleccionarHora(),mostrarResumen()}function mostrarSeccion(){const e=document.querySelector(".actual");e&&e.classList.remove("actual");const t=document.querySelector(".mostrar");t&&t.classList.remove("mostrar");const o="#paso-"+paso;document.querySelector(o).classList.add("mostrar");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){paso=parseInt(e.target.dataset.paso),mostrarSeccion(),botonesPaginador()}))})}function botonesPaginador(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");1===paso?(t.classList.remove("ocultar"),e.classList.add("ocultar")):2===paso?(e.classList.remove("ocultar"),t.classList.remove("ocultar")):(e.classList.remove("ocultar"),t.classList.add("ocultar"),mostrarResumen())}function paginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",(function(){paso>=3||(paso++,mostrarSeccion(),botonesPaginador())}))}function paginaAnterior(){document.querySelector("#anterior").addEventListener("click",(function(){paso<=1||(paso--,mostrarSeccion(),botonesPaginador())}))}async function consultarAPI(){try{const e="http://localhost:3000/api/servicios",t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){e.forEach(e=>{const{id:t,nombre:o,descripcion:a,imagen:n}=e,c=document.createElement("P");c.classList.add("nombre-servicio"),c.textContent=o;const r=document.createElement("DIV");r.classList.add("contenedor-nombre"),r.appendChild(c);const s=document.createElement("P");s.classList.add("descripcion-servicio"),s.textContent=a;const i=document.createElement("DIV");i.classList.add("contenedor-descripcion"),i.appendChild(s);const l=document.createElement("IMG");l.classList.add("imagen-servicio"),l.src=n;const d=document.createElement("DIV");d.classList.add("servicio"),d.dataset.idServicio=t,d.onclick=function(){SeleccionarServicio(e)},d.appendChild(r),d.appendChild(i),d.appendChild(l),document.querySelector("#servicios").appendChild(d)})}function SeleccionarServicio(e){const{id:t}=e,{servicios:o}=cita;cita.servicios=e;const a=document.querySelector(".seleccionado");a&&a.classList.remove("seleccionado");const n=document.querySelector(`[data-id-servicio="${t}"]`);n.classList.add("seleccionado"),o.id===e.id&&(n.classList.remove("seleccionado"),cita.servicios=[]),mostrarResumen()}function nombreCliente(){const e=document.querySelector("#nombre").value;cita.nombre=e;const t=document.querySelector("#id");cita.id=t.value}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(mostrarAlerta("Fines de semana no trabaja el Hospital","error","#paso-2 p",!0),e.target.value=""):cita.fecha=e.target.value}))}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(function(e){const t=e.target.value,o=t.split(":")[0];o<10||o>18?(mostrarAlerta("Hora no vÃ¡lida para reservar una cita","error","#paso-2 p",!0),e.target.value=""):(cita.hora=t,console.log(cita))}))}function mostrarAlerta(e,t,o,a){const n=document.querySelector(".alerta");n&&n.remove();const c=document.createElement("DIV");c.textContent=e,c.classList.add("alerta"),c.classList.add("w-100"),c.classList.add(t);const r=document.querySelector(o);if(1===paso||2===paso){const e=o.split(" ")[0];console.log(e);const t=document.querySelector(".divi");console.log("asdfas",t),t.textContent="",r.appendChild(c),!0===a&&setTimeout(()=>{c.remove()},3e3)}r.appendChild(c),!0===a&&setTimeout(()=>{c.remove()},3e3)}function mostrarResumen(){if(Object.values(cita).includes("")||0===cita.servicios.length)mostrarAlerta("Faltan datos de servicio, fecha u hora de cita","error","#paso-3 p",!1);else{const{nombre:e,fecha:t,hora:o,servicios:a}=cita;console.log(cita);const n=document.querySelector(".error");n&&n.remove();const c=document.querySelector(".contenido-resumen"),r=document.querySelector(".mostrara");r&&r.remove();const s=document.createElement("DIV");s.classList.add("mostrara");const i=document.createElement("P");i.innerHTML=`<label><strong>Nombre: </strong></label> ${e} `;const l=document.createElement("P");l.innerHTML=`<label><strong>Servicio: </strong></label> ${a.nombre} `;const d=new Date(t),u=d.getMonth(),m=d.getDate()+2,p=d.getFullYear(),v={weekday:"long",year:"numeric",month:"long",day:"numeric"},h=new Date(Date.UTC(p,u,m)).toLocaleDateString("es-MX",v);console.log(h);const g=document.createElement("P");g.innerHTML=`<label><strong>Fecha cita: </strong></label> ${h} `;const f=document.createElement("P");f.innerHTML=`<label><strong>Hora cita: </strong></label> ${o} Horas `;const S=document.createElement("BUTTON");S.classList.add("boton"),S.textContent="Enviar y Reservar",S.onclick=reservarCita;const L=document.createElement("DIV");L.classList.add("div-boton"),L.appendChild(S),s.appendChild(i),s.appendChild(g),s.appendChild(f),s.appendChild(l),c.appendChild(s),c.appendChild(L)}}async function reservarCita(){const{nombre:e,fecha:t,hora:o,servicios:a,id:n}=cita,c=new FormData;c.append("usuarioId",n),c.append("fecha",t),c.append("hora",o),c.append("servicios",a.id);try{const e="http://localhost:3000/api/citas",t=await fetch(e,{method:"POST",body:c}),o=await t.json();console.log(o),o.resultado&&Swal.fire({icon:"success",title:"Cita creada",text:"La cita fue creada correctamente !",showConfirmButton:!1}).then((function(){}))}catch(e){console.log(e),Swal.fire({icon:"error",title:"Error",text:"No se pudo guardar la cita !",showConfirmButton:!1}).then((function(){}))}}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));